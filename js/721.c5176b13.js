"use strict";(self["webpackChunkp_blossom"]=self["webpackChunkp_blossom"]||[]).push([[721],{1105:function(e,t,l){l.r(t),l.d(t,{default:function(){return ke}});var a=l(6252),d=l(3577),r=l(9963);const s={class:"container"},i=(0,a._)("h1",{class:"fs-3 py-6"},"訂單管理",-1),n={class:"card card-body border-0 shadow table-wrapper table-responsive"},o={class:"table table-hover align-middle"},c=(0,a._)("thead",null,[(0,a._)("tr",null,[(0,a._)("th",{class:"border-gray-200"},"購買時間"),(0,a._)("th",{class:"border-gray-200"},"姓 名"),(0,a._)("th",{class:"border-gray-200"},"Email"),(0,a._)("th",{class:"border-gray-200"},"購買品項"),(0,a._)("th",{class:"border-gray-200"},"應付金額"),(0,a._)("th",{class:"border-gray-200"},"是否付款"),(0,a._)("th",{class:"border-gray-200 text-center"},"編 輯"),(0,a._)("th",{class:"border-gray-200 text-center"},"刪 除")])],-1),u={class:"list-unstyled"},p={class:"text-end"},h={class:"fw-bold me-4"},_={class:"form-check form-switch"},m=["id","onUpdate:modelValue","onChange"],g=["for"],b={key:0,class:"text-success"},w={key:1},y={class:"text-center"},f=["onClick"],O={class:"text-center"},k=["onClick"],v={class:"card-footer px-3 border-0 d-flex flex-column flex-lg-row align-items-center justify-content-between"},x={class:"fw-normal small mt-4 mt-lg-0"};function D(e,t,l,D,M,$){const z=(0,a.up)("v-loading"),L=(0,a.up)("vue-feather"),P=(0,a.up)("pagination-tool"),C=(0,a.up)("update-order-modal"),S=(0,a.up)("delete-modal");return(0,a.wg)(),(0,a.iD)("div",s,[i,(0,a._)("div",n,[(0,a.Wm)(z,{active:M.isLoading},null,8,["active"]),(0,a._)("table",o,[c,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(M.orders,(e=>((0,a.wg)(),(0,a.iD)("tr",{key:e.id},[(0,a._)("td",null,(0,d.zw)(e.create_at),1),(0,a._)("td",null,(0,d.zw)(e.user.name),1),(0,a._)("td",null,(0,d.zw)(e.user.email),1),(0,a._)("td",null,[(0,a._)("ul",u,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(e.products,(e=>((0,a.wg)(),(0,a.iD)("li",{key:e.id}," 〔"+(0,d.zw)(e.product.title)+" 〕 數量："+(0,d.zw)(e.product.num)+" "+(0,d.zw)(e.product.unit),1)))),128))])]),(0,a._)("td",p,[(0,a._)("span",h,(0,d.zw)(e.total),1)]),(0,a._)("td",null,[(0,a._)("div",_,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`paidSwitch${e.id}`,"onUpdate:modelValue":t=>e.is_paid=t,onChange:t=>$.updatePaid(e)},null,40,m),[[r.e8,e.is_paid]]),(0,a._)("label",{class:"form-check-label",for:`paidSwitch${e.id}`},[e.is_paid?((0,a.wg)(),(0,a.iD)("span",b,"已付款")):((0,a.wg)(),(0,a.iD)("span",w,"未付款"))],8,g)])]),(0,a._)("td",y,[(0,a._)("button",{type:"button",class:"edit-btn border-0 bg-transparent px-3 py-2",onClick:t=>$.callOrderModal(e)},[(0,a.Wm)(L,{type:"edit"})],8,f)]),(0,a._)("td",O,[(0,a._)("button",{type:"button",class:"delete-btn border-0 bg-transparent px-3 py-2",onClick:t=>$.callDeleteOrderModal(e)},[(0,a.Wm)(L,{type:"trash-2"})],8,k)])])))),128))])]),(0,a._)("div",v,[(0,a.Wm)(P,{pages:M.pagination,onEmitPages:$.getOrders},null,8,["pages","onEmitPages"]),(0,a._)("div",x,[(0,a._)("p",null,"本頁 "+(0,d.zw)(M.orders.length)+" 筆",1)])])]),(0,a.Wm)(C,{ref:"orderModal",order:M.tempOrder,onUpdatePaid:$.updatePaid},null,8,["order","onUpdatePaid"]),(0,a.Wm)(S,{ref:"deleteModal",item:M.tempOrder,onDelItem:$.deleteOrder},null,8,["item","onDelItem"])])}var M=l(4295),$=l(7729);const z={class:"modal fade",id:"orderModal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true",ref:"modal"},L={class:"modal-dialog modal-xl"},P={class:"modal-content"},C=(0,a._)("div",{class:"modal-header bg-ad-primary text-white"},[(0,a._)("h5",{class:"modal-title",id:"orderModalLabel"},"訂單內容"),(0,a._)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),S={class:"modal-body"},U={class:"row"},W={class:"col-md-4"},Z=(0,a._)("h3",null,"購買者資訊",-1),j={class:"table align-middle"},E={key:0},H=(0,a._)("th",null,"姓名",-1),K=(0,a._)("th",null,"Email",-1),V=(0,a._)("th",null,"電話",-1),Y=(0,a._)("th",null,"地址",-1),q={class:"col-md-8"},I=(0,a._)("h3",null,"購買資訊",-1),T={class:"table align-middle"},A={key:0},B=(0,a._)("th",null,"訂單編號",-1),F=(0,a._)("th",null,"下單時間",-1),G=(0,a._)("th",null,"付款時間",-1),J={key:0},N={key:1},Q=(0,a._)("th",null,"付款狀態",-1),R={key:0,class:"text-success"},X=(0,a._)("strong",null,"已付款",-1),ee=[X],te={key:1,class:"text-muted"},le=(0,a._)("th",null,"總金額",-1),ae=(0,a._)("h3",null,"購買品項",-1),de={class:"table align-middle"},re=(0,a._)("thead",null,[(0,a._)("tr")],-1),se={class:"text-end"},ie={class:"d-flex justify-content-end"},ne={class:"form-check form-switch"},oe={class:"form-check-label",for:"paidSwitch"},ce={key:0},ue={key:1},pe={class:"modal-footer"},he=(0,a._)("button",{type:"button",class:"btn btn-outline-dark","data-bs-dismiss":"modal"},"取 消",-1);function _e(e,t,l,s,i,n){return(0,a.wg)(),(0,a.iD)("div",z,[(0,a._)("div",L,[(0,a._)("div",P,[C,(0,a._)("div",S,[(0,a._)("div",U,[(0,a._)("div",W,[Z,(0,a._)("table",j,[i.tempOrder.user?((0,a.wg)(),(0,a.iD)("tbody",E,[(0,a._)("tr",null,[H,(0,a._)("td",null,(0,d.zw)(i.tempOrder.user.name),1)]),(0,a._)("tr",null,[K,(0,a._)("td",null,(0,d.zw)(i.tempOrder.user.email),1)]),(0,a._)("tr",null,[V,(0,a._)("td",null,(0,d.zw)(i.tempOrder.user.tel),1)]),(0,a._)("tr",null,[Y,(0,a._)("td",null,(0,d.zw)(i.tempOrder.user.address),1)])])):(0,a.kq)("",!0)])]),(0,a._)("div",q,[I,(0,a._)("table",T,[i.tempOrder.user?((0,a.wg)(),(0,a.iD)("tbody",A,[(0,a._)("tr",null,[B,(0,a._)("td",null,(0,d.zw)(i.tempOrder.id),1)]),(0,a._)("tr",null,[F,(0,a._)("td",null,(0,d.zw)(e.$filters.date(i.tempOrder.create_at)),1)]),(0,a._)("tr",null,[G,(0,a._)("td",null,[i.tempOrder.paid_date?((0,a.wg)(),(0,a.iD)("span",J,(0,d.zw)(e.$filters.date(i.tempOrder.paid_date)),1)):((0,a.wg)(),(0,a.iD)("span",N,"時間不正確"))])]),(0,a._)("tr",null,[Q,(0,a._)("td",null,[i.tempOrder.is_paid?((0,a.wg)(),(0,a.iD)("span",R,ee)):((0,a.wg)(),(0,a.iD)("span",te,"尚未付款"))])]),(0,a._)("tr",null,[le,(0,a._)("td",null,(0,d.zw)(e.$filters.currency(i.tempOrder.total)),1)])])):(0,a.kq)("",!0)]),ae,(0,a._)("table",de,[re,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(i.tempOrder.products,(t=>((0,a.wg)(),(0,a.iD)("tr",{key:t.id},[(0,a._)("th",null,(0,d.zw)(t.product.title),1),(0,a._)("td",null,(0,d.zw)(t.product.num)+" / "+(0,d.zw)(t.product.unit),1),(0,a._)("td",se,(0,d.zw)(e.$filters.currency(t.total)),1)])))),128))])]),(0,a._)("div",ie,[(0,a._)("div",ne,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"paidSwitch",value:"","onUpdate:modelValue":t[0]||(t[0]=e=>i.tempOrder.is_paid=e)},null,512),[[r.e8,i.tempOrder.is_paid]]),(0,a._)("label",oe,[i.tempOrder.is_paid?((0,a.wg)(),(0,a.iD)("span",ce,"已付款")):((0,a.wg)(),(0,a.iD)("span",ue,"未付款"))])])])])])]),(0,a._)("div",pe,[he,(0,a._)("button",{type:"button",class:"btn btn-ad-primary",onClick:t[1]||(t[1]=t=>e.$emit("update-paid",i.tempOrder))},"修改付款狀態")])])])],512)}var me=l(1339),ge={props:{order:{type:Object,default(){return{}}}},data(){return{modal:"",tempOrder:{}}},mixins:[me.Z],inject:["emitter"],emits:["update-paid"],watch:{order(){this.tempOrder=this.order}}},be=l(3744);const we=(0,be.Z)(ge,[["render",_e]]);var ye=we,fe={data(){return{orders:{},tempOrder:{},pagination:{},currentPage:1,isLoading:!1}},components:{PaginationTool:M.Z,DeleteModal:$.Z,UpdateOrderModal:ye},methods:{getOrders(e=1){this.currentPage=e;const t=`https://vue3-course-api.hexschool.io/v2/api/erinhuang-lab/admin/orders?page=${e}`;this.isLoading=!0,this.$http.get(t).then((e=>{this.orders=e.data.orders,this.pagination=e.data.pagination,this.isLoading=!1})).catch((e=>{this.isLoading=!1,console.dir(e),this.$httpMessageState(e.response,"錯誤訊息")}))},callDeleteOrderModal(e){this.tempOrder={...e};const t=this.$refs.deleteModal;t.openModal()},deleteOrder(){const e=`https://vue3-course-api.hexschool.io/v2/api/erinhuang-lab/admin/order/${this.tempOrder.id}`;this.isLoading=!0,this.$http.delete(e).then((e=>{const t=this.$refs.deleteModal;t.hideModal(),this.isLoading=!1,this.getOrders(this.currentPage),this.$httpMessageState(e,"刪除訂單")})).catch((e=>{this.isLoading=!1,this.$httpMessageState(e.response,"錯誤訊息")}))},callOrderModal(e){this.tempOrder={...e};const t=this.$refs.orderModal;t.openModal()},updatePaid(e){this.isLoading=!0;const t={is_paid:e.is_paid},l=`https://vue3-course-api.hexschool.io/v2/api/erinhuang-lab/admin/order/${e.id}`;this.$http.put(l,{data:t}).then((e=>{this.isLoading=!1;const t=this.$refs.orderModal;t.hideModal(),this.getOrders(this.currentPage)})).catch((e=>{this.isLoading=!1,this.$httpMessageState(e.response,"錯誤訊息")}))}},created(){this.getOrders()}};const Oe=(0,be.Z)(fe,[["render",D]]);var ke=Oe}}]);
//# sourceMappingURL=721.c5176b13.js.map